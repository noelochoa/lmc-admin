(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"392b":function(t,e,a){"use strict";a("4d90"),a("5319");var o,r,n={data(){return{prevRoute:null}},beforeRouteEnter(t,e,a){a((t=>{t.prevRoute=e}))},computed:{today(){const t=new Date,e={month:t.toLocaleDateString("en-US",{month:"long"}),year:t.getFullYear(),dayOfMonth:t.getDate(),dayOfWeek:t.getDay(),human:t.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),iso:t.toISOString(),yyyymmdd:t.getFullYear()+"-"+(t.getMonth()+1).toString().padStart(2,0)+"-"+t.getDate().toString().padStart(2,"0")};return e},startDayOfMonth(){const t=new Date;return new Date(t.getFullYear(),t.getMonth(),1)},lastDayOfMonth(){const t=new Date;return new Date(t.getFullYear(),t.getMonth()+1,0)}},methods:{replaceAll:function(t,e,a){return t.replace(new RegExp(e,"g"),a)},resolveAssetsUrl:function(t){return"https://localhost:3000/"+t},showNotif:function(t,e){this.$q.notify({color:t?"green-4":"negative",textColor:"white",icon:t?"check_circle_outline":"error_outline",timeout:"2500",position:"top",message:e})},returnToPageIndex:function(t){this.prevRoute&&"/"!==this.prevRoute.path?this.$router.go(-1):this.$router.push(t).catch((t=>{}))},findMaxDt:function(t,e){return new Date(Math.max(new Date(t),new Date(e)))},findMinDt:function(t,e){return new Date(Math.min(new Date(t),new Date(e)))},toQDateFormat:function(t){return t?t.getFullYear()+"/"+(t.getMonth()+1).toString().padStart(2,0)+"/"+t.getDate().toString().padStart(2,0):t},toHumanReadableDt:function(t){const e=new Date(t);return e?e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})+" "+e.getHours().toString().padStart(2,0)+":"+e.getMinutes().toString().padStart(2,0):t}}},s=n,i=a("2877"),l=Object(i["a"])(s,o,r,!1,null,null,null);e["a"]=l.exports},"3c6b":function(t,e,a){},5366:function(t,e,a){"use strict";var o=a("641f"),r=a.n(o);r.a},"641f":function(t,e,a){},9277:function(t,e,a){"use strict";var o=a("3c6b"),r=a.n(o);r.a},"96ec":function(t,e,a){"use strict";var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-dialog",{attrs:{value:t.showDlg,square:""},on:{hide:t.emitClose}},[a("q-card",{attrs:{dark:""}},[a("q-card-section",{staticClass:"row items-center"},[t._t("avatar"),a("span",{staticClass:"q-ml-sm"},[t._t("message")],2)],2),a("q-card-actions",{attrs:{align:"right"}},[t._t("actions")],2)],1)],1)},r=[],n={name:"ConfirmDialog",props:{showDlg:{type:Boolean,required:!0,default:!1}},methods:{emitClose(){this.$emit("update:showDlg",!1)}}},s=n,i=a("2877"),l=a("24e8"),c=a("f09f"),u=a("a370"),d=a("4b7e"),g=a("eebe"),p=a.n(g),h=Object(i["a"])(s,o,r,!1,null,null,null);e["a"]=h.exports;p()(h,"components",{QDialog:l["a"],QCard:c["a"],QCardSection:u["a"],QCardActions:d["a"]})},e981:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"q-px-md q-pt-lg"},[a("div",{staticClass:"page-heading text-white q-pa-md"},[a("div",{staticClass:"heading-caption"},[a("h6",[t._v("Products")]),a("br"),a("p",[t._v("The following is a list of products in the webstore.")])])]),a("div",{staticClass:"page-contents text-white q-pa-md"},[a("div",{staticClass:"content-1"},[a("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",round:"",icon:"post_add",to:"/products/add/1"}},[a("q-tooltip",{attrs:{anchor:"bottom right",self:"top middle",offset:[10,10]}},[t._v("Add Product")])],1),a("q-select",{staticClass:"filter-select",attrs:{options:t.filter,disable:t.loading,dark:"",dense:"",outlined:"","options-dense":""},on:{input:t.filterChanged},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"category"}})]},proxy:!0}]),model:{value:t.category,callback:function(e){t.category=e},expression:"category"}}),a("q-btn",{staticClass:"q-ml-sm",attrs:{flat:"",round:"",icon:"add",to:"/categories/add"}},[a("q-tooltip",{attrs:{anchor:"bottom right",self:"top middle",offset:[10,10]}},[t._v("Add Category")])],1)],1),a("div",{staticClass:"content-2"},[a("q-input",{staticClass:"filter-search-box",attrs:{type:"search",placeholder:"Search product",debounce:"500",dark:"",dense:"",outlined:""},on:{input:t.searchInput},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0},{key:"append",fn:function(){return[a("transition",{attrs:{name:"fade"}},[a("q-icon",{directives:[{name:"show",rawName:"v-show",value:""!=t.search,expression:"search != ''"}],staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:t.searchClear}})],1)]},proxy:!0}]),model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),a("div",{staticClass:"content-3"},[a("q-table",{ref:"prodsTbl",staticClass:"products-table",attrs:{grid:"","grid-header":"",title:"Store Products","row-key":"id",data:t.data,columns:t.columns,"rows-per-page-options":[0],pagination:t.pagination,selected:t.selected,selection:"multiple",filter:t.search,loading:t.loading},on:{"update:pagination":[function(e){t.pagination=e},t.onChgPage],"update:selected":function(e){t.selected=e},request:t.onRequest},scopedSlots:t._u([{key:"top-right",fn:function(){return[a("q-btn",{staticClass:"q-px-xs",attrs:{dense:"",flat:"",size:"sm",icon:"arrow_drop_down",label:"Bulk action"}},[a("q-menu",{attrs:{"content-class":"bg-grey-10","auto-close":""}},[a("q-list",{attrs:{dark:""}},[a("q-item",{staticClass:"text-caption",attrs:{dense:"",clickable:""},on:{click:function(e){return t.confirmBulkAction(!0)}}},[a("q-item-section",[t._v("\n                                        Reactivate selected\n                                    ")])],1),a("q-item",{staticClass:"text-caption",attrs:{dense:"",clickable:""},on:{click:function(e){return t.confirmBulkAction(!1)}}},[a("q-item-section",[t._v("\n                                        Archive selected\n                                    ")])],1)],1)],1)],1)]},proxy:!0},{key:"header-small",fn:function(){return[a("q-btn",{staticClass:"q-px-xs",attrs:{dense:"",flat:"",size:"sm",icon:"arrow_drop_down",label:"Bulk actions"}},[a("q-menu",{attrs:{"content-class":"bg-grey-10","auto-close":""}},[a("q-list",{attrs:{dark:""}},[a("q-item",{staticClass:"text-caption",attrs:{dense:"",clickable:""}},[a("q-item-section",[t._v("\n                                        Show selected\n                                    ")])],1),a("q-item",{staticClass:"text-caption",attrs:{dense:"",clickable:""}},[a("q-item-section",[t._v("\n                                        Hide selected\n                                    ")])],1)],1)],1)],1)]},proxy:!0},{key:"item",fn:function(e){return[a("div",{staticClass:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-4"},[a("q-card",{staticClass:"bg-gray-alpha-2"},[a("q-img",{staticClass:"product-img",attrs:{src:e.row.images&&e.row.images[0]?t.resolveAssetsUrl(e.row.images[0].image):"https://dummyimage.com/640x480/454345/fafafa.png&text=No+Img",basic:""}},[a("div",{staticClass:"absolute-top"},[a("q-checkbox",{staticClass:"q-mr-sm",attrs:{dense:"",color:"grey-8"},model:{value:e.selected,callback:function(a){t.$set(e,"selected",a)},expression:"props.selected"}}),t._v(t._s(e.row.name)+"\n                                ")],1)]),a("q-separator"),a("q-list",{attrs:{dense:""}},t._l(e.cols.filter((function(t){return"name"!==t.name})),(function(e){return a("q-item",{key:e.name},[a("q-item-section",[a("q-item-label",[t._v(t._s(e.label))])],1),a("q-item-section",{attrs:{side:""}},[a("q-item-label",{staticClass:"text-primary"},[t._v(t._s(e.value))])],1)],1)})),1),a("q-separator"),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"build",to:"/products/edit/"+e.row.id}},[a("q-tooltip",{attrs:{anchor:"bottom right",self:"top middle",offset:[10,10]}},[t._v("Configure\n                                    ")])],1),a("q-btn",{attrs:{dense:"",flat:"",round:"",icon:e.row.isFeatured?"star":"star_outline",to:"/products/feature/"+e.row.id}},[a("q-tooltip",{attrs:{anchor:"bottom right",self:"top middle",offset:[10,10]}},[t._v("Feature product config\n                                    ")])],1),a("q-btn",{attrs:{dense:"",flat:"",round:"",icon:e.row.toggleFlg?"visibility":"visibility_off"},on:{mouseenter:function(t){e.row.toggleFlg=!e.row.toggleFlg},mouseleave:function(t){e.row.toggleFlg=!e.row.toggleFlg},click:function(a){return t.confirmAction(e.row.id,!e.row.isActive)}}},[a("q-tooltip",{attrs:{anchor:"bottom right",self:"top middle",offset:[10,10]}},[t._v("\n                                        "+t._s(e.row.isActive?"Archive this product":"Reactivate product")+"\n                                    ")])],1)],1)],1)],1)]}}])}),a("ConfirmDialog",{attrs:{showDlg:t.showDlg},on:{"update:showDlg":function(e){t.showDlg=e},"update:show-dlg":function(e){t.showDlg=e}},scopedSlots:t._u([{key:"avatar",fn:function(){return[a("q-avatar",{attrs:{icon:"report_problem",color:"red-5","text-color":"white"}})]},proxy:!0},t.targetVal?{key:"message",fn:function(){return[t._v("\n                    This action will "),a("u",[t._v("REACTIVATE")]),t._v(" the product. "),a("br"),t._v("\n                    Product will be visible again on the webstore.\n                ")]},proxy:!0}:{key:"message",fn:function(){return[t._v("\n                    This action will "),a("u",[t._v("ARCHIVE")]),t._v(" the product. "),a("br"),t._v("\n                    Product will be hidden in the webstore.\n                ")]},proxy:!0},{key:"actions",fn:function(){return[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Proceed",color:"red-5"},on:{click:t.onProceed}})]},proxy:!0}],null,!0)}),a("ConfirmDialog",{attrs:{showDlg:t.showDlgBulk},on:{"update:showDlg":function(e){t.showDlgBulk=e},"update:show-dlg":function(e){t.showDlgBulk=e}},scopedSlots:t._u([{key:"avatar",fn:function(){return[a("q-avatar",{attrs:{icon:"report_problem",color:"red-5","text-color":"white"}})]},proxy:!0},t.targetValBulk?{key:"message",fn:function(){return[t._v("\n                    This action will "),a("u",[t._v("REACTIVATE")]),t._v(" the selected\n                    products. "),a("br"),t._v("\n                    Products will be visible again on the webstore.\n                ")]},proxy:!0}:{key:"message",fn:function(){return[t._v("\n                    This action will "),a("u",[t._v("ARCHIVE")]),t._v(" the selected products.\n                    "),a("br"),t._v("\n                    Products will be hidden in the webstore.\n                ")]},proxy:!0},{key:"actions",fn:function(){return[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Proceed",color:"red-5"},on:{click:t.onProceedAll}})]},proxy:!0}],null,!0)})],1)])])},r=[],n=(a("fb6a"),a("a434"),a("5319"),a("ddb0"),a("c973")),s=a.n(n),i=a("ded3"),l=a.n(i),c=a("96ec"),u=a("392b");let d=null,g=null;var p={name:"ProductIndex",components:{ConfirmDialog:c["a"]},mixins:[u["a"]],meta(){return{title:"Products"}},beforeCreate(){g=this.$RepositoryFactory.get("categories"),d=this.$RepositoryFactory.get("products")},created(){this.$route.query.type&&(this.category=this.$route.query.type),this.$route.query.s&&(this.search=this.$route.query.s),this.$route.query.p&&!isNaN(this.$route.query.p)&&(this.pagination.page=Number.parseInt(this.$route.query.p)),this.fetchCategories()},mounted(){this.onRequest({pagination:this.pagination,filter:void 0})},data(){return{productsList:[],selected:[],search:"",category:"All",filter:["All"],loading:!0,showDlg:!1,showDlgBulk:!1,toToggleID:-1,targetVal:!1,targetValBulk:!1,pagination:{sortBy:"created",descending:!0,page:1,rowsPerPage:9},columns:[{name:"name",field:"name",label:"Name",align:"left",required:!0,sortable:!0},{name:"created",field:"created",align:"left",label:"Created",sortable:!0},{name:"category",field:"category",align:"left",label:"Category",sortable:!0},{name:"basePrice",field:"basePrice",align:"left",label:"Base price",sortable:!0}],data:[],original:[]}},methods:{filterChanged(t){const e=this.$route.query.type;!this.filter.includes(t)||e&&t.match(new RegExp(e,"i"))||(this.$router.replace({query:{type:t}}).catch((t=>{})),this.search=""),this.$refs["prodsTbl"].requestServerInteraction({pagination:l()(l()({},this.pagination),{},{page:1})})},searchClear(t){let e=Object.assign({},this.$route.query);delete e.s,this.$router.replace({query:e}).catch((t=>{})),this.search=""},searchInput(t){let e=Object.assign({},this.$route.query,{s:t});t||delete e.s,this.$router.replace({query:e}).catch((t=>{}))},onChgPage(t){let e=Object.assign({},this.$route.query,{p:t.page});t||delete e.p,this.$router.replace({query:e}).catch((t=>{}))},fetchCategories(){var t=this;return s()((function*(){try{const e=yield g.getCategoriesSelection();t.filter=[...t.filter,...e.slice()];const a=new RegExp(t.$route.query.type,"i"),o=t.filter.find((t=>t.match(a)));t.category=o||""}catch(e){t.showNotif(!1,"Could not retrieve product categories.")}}))()},onRequest(t){var e=this;return s()((function*(){e.loading=!0;try{const a=yield d.getProducts(e.category);e.original=a.products,e.data=e.original.slice(),e.pagination.page=t.pagination.page}catch(a){e.showNotif(!1,"Could not retrieve products.")}finally{e.loading=!1}}))()},confirmAction(t,e){this.targetVal=e,this.showDlg=!0,this.toToggleID=t},confirmBulkAction(t){this.targetValBulk=t,this.showDlgBulk=!0},onProceed(){var t=this;return s()((function*(){if(-1!==t.toToggleID)try{yield d.toggleActiveProduct(t.toToggleID,t.targetVal);t.showNotif(!0,t.targetVal?"Product has been reactivated.":"Product has been archived."),t.data.forEach((e=>{e.id===t.toToggleID&&(e.isActive=t.targetVal,e.toggleFlg=t.targetVal)})),t.toToggleID=-1,t.targetVal=!1}catch(e){t.showNotif(!1,"Could not update this item. ")}}))()},onProceedAll(){var t=this;return s()((function*(){if(t.selected&&t.selected.length>0)try{const e=t.selected.map((t=>t.id));yield d.toggleAll(e,t.targetValBulk);t.showNotif(!0,t.targetValBulk?"Products have been reactivated.":"Products have been archived."),t.data.forEach((a=>{e.includes(a.id)&&(a.isActive=t.targetValBulk,a.toggleFlg=t.targetValBulk)})),t.selected.splice(0,t.selected.length),t.targetValBulk=!1}catch(e){t.showNotif(!1,"Could not update items. "+e)}}))()}}},h=p,f=(a("9277"),a("5366"),a("2877")),m=a("9989"),b=a("9c40"),v=a("05c0"),y=a("ddd8"),w=a("0016"),q=a("66e5"),C=a("27f9"),k=a("eaac"),_=a("4e73"),D=a("1c1c"),x=a("4074"),S=a("f09f"),A=a("068f"),P=a("8f8e"),$=a("eb85"),I=a("0170"),Q=a("4b7e"),B=a("cb32"),R=a("7f67"),T=a("eebe"),V=a.n(T),F=Object(f["a"])(h,o,r,!1,null,"c408557e",null);e["default"]=F.exports;V()(F,"components",{QPage:m["a"],QBtn:b["a"],QTooltip:v["a"],QSelect:y["a"],QIcon:w["a"],QItem:q["a"],QInput:C["a"],QTable:k["a"],QMenu:_["a"],QList:D["a"],QItemSection:x["a"],QCard:S["a"],QImg:A["a"],QCheckbox:P["a"],QSeparator:$["a"],QItemLabel:I["a"],QCardActions:Q["a"],QAvatar:B["a"]}),V()(F,"directives",{ClosePopup:R["a"]})}}]);