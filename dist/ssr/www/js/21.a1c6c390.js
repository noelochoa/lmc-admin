(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{"130f":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"q-px-md q-pt-lg"},[a("div",{staticClass:"page-heading text-white q-pa-md"},[a("div",{staticClass:"heading-caption"},[a("h6",[t._v("Edit Discount Rule")]),a("br"),a("p",[t._v("You may edit the following product discount entry.")])])]),a("div",{staticClass:"page-contents text-white q-pa-md"},[a("div",{staticClass:"content-1"},[a("div",{staticClass:"text-subtitle2 flex flex-center"},[a("q-icon",{staticClass:"caption-icon q-mx-md",attrs:{name:"account_circle"}}),t._v("Discount Details\n            ")],1),a("div",[a("q-form",{attrs:{disabled:t.discount.hasError||t.discount.loading},on:{submit:function(e){return e.preventDefault(),e.stopPropagation(),t.onSubmit(e)}}},[t.discount.loading?a("q-item",{staticClass:"q-mt-sm"},[a("q-spinner",{attrs:{color:"white",size:"2em"}})],1):a("q-list",{staticClass:"detail-list",attrs:{separator:""}},[a("q-item",{staticClass:"detail-field"},[a("span",{staticClass:"field-label"},[t._v("Starts from")]),a("q-input",{staticClass:"field-value",attrs:{dense:"",outlined:"","hide-bottom-space":"",dark:"",rules:[function(t){return null!==t&&""!==t.trim()},t._isValidDatetime]},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxyS",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{dark:"","no-unset":"",mask:"YYYY-MM-DD HH:mm"},on:{input:function(){return t.$refs.qDateProxyS.hide()}},model:{value:t.discount.data.start,callback:function(e){t.$set(t.discount.data,"start",e)},expression:"\n                                                    discount.data.start\n                                                "}})],1)],1)]},proxy:!0},{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"access_time"}},[a("q-popup-proxy",{ref:"qTimeProxyS",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-time",{attrs:{dark:"",mask:"YYYY-MM-DD HH:mm",format24h:""},on:{input:function(){return t.$refs.qTimeProxyS.hide()}},model:{value:t.discount.data.start,callback:function(e){t.$set(t.discount.data,"start",e)},expression:"\n                                                    discount.data.start\n                                                "}})],1)],1)]},proxy:!0}]),model:{value:t.discount.data.start,callback:function(e){t.$set(t.discount.data,"start",e)},expression:"discount.data.start"}})],1),a("q-item",{staticClass:"detail-field"},[a("span",{staticClass:"field-label"},[t._v("Ends at")]),a("q-input",{staticClass:"field-value",attrs:{dense:"",outlined:"","hide-bottom-space":"",dark:"","lazy-rules":"",rules:[function(t){return null!==t&&""!==t.trim()},t._isValidDatetime,t._isValidEndDt]},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxyE",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{dark:"","no-unset":"",mask:"YYYY-MM-DD HH:mm"},on:{input:function(){return t.$refs.qDateProxyE.hide()}},model:{value:t.discount.data.end,callback:function(e){t.$set(t.discount.data,"end",e)},expression:"discount.data.end"}})],1)],1)]},proxy:!0},{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"access_time"}},[a("q-popup-proxy",{ref:"qTimeProxyE",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-time",{attrs:{dark:"",mask:"YYYY-MM-DD HH:mm",format24h:""},on:{input:function(){return t.$refs.qTimeProxyE.hide()}},model:{value:t.discount.data.end,callback:function(e){t.$set(t.discount.data,"end",e)},expression:"discount.data.end"}})],1)],1)]},proxy:!0}]),model:{value:t.discount.data.end,callback:function(e){t.$set(t.discount.data,"end",e)},expression:"discount.data.end"}})],1),a("q-item",{staticClass:"detail-field"},[a("span",{staticClass:"field-label"},[t._v("Target Customer")]),a("q-select",{staticClass:"field-value",attrs:{options:t.targets,dark:"",dense:"",outlined:"","hide-bottom-space":"","options-dense":"","lazy-rules":"",rules:[function(t){return null!==t&&""!==t.trim()},function(e){return t.targets.includes(e)}]},on:{input:function(e){t.hasSelect=!0}},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"person_outline"}})]},proxy:!0}]),model:{value:t.discount.data.target,callback:function(e){t.$set(t.discount.data,"target",e)},expression:"discount.data.target"}})],1),a("q-item",{staticClass:"detail-field"},[a("span",{staticClass:"field-label"},[t._v("Discount (%)")]),a("q-slider",{staticClass:"field-value q-mx-xs",attrs:{min:1,max:99,label:"",color:"green-4"},model:{value:t.discount.data.value,callback:function(e){t.$set(t.discount.data,"value",e)},expression:"discount.data.value"}})],1),a("q-item",{staticClass:"detail-field"},[a("span",{staticClass:"field-label"},[t._v("Apply to")]),a("q-select",{staticClass:"products-select field-value",attrs:{options:t.options,label:"Products","hide-dropdown-icon":"","hide-bottom-space":"",dark:"",dense:"",outlined:"",multiple:"","use-chips":"","use-input":"","emit-value":"","map-options":"","lazy-rules":"",rules:[function(t){return null!==t&&t.length>0}]},on:{filter:t.filterFn},scopedSlots:t._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-italic text-grey"},[t._v("\n                                            No products found.\n                                        ")])],1)]},proxy:!0}]),model:{value:t.discount.data.products,callback:function(e){t.$set(t.discount.data,"products",e)},expression:"discount.data.products"}})],1)],1),a("q-separator"),a("div",{staticClass:"q-pa-md"},[a("q-btn",{attrs:{label:"Save",type:"submit",color:"primary",loading:t.loading,disable:t.loading||!t.hasSelect},scopedSlots:t._u([{key:"loading",fn:function(){return[a("q-spinner-gears")]},proxy:!0}])}),t._v("\n                        "+t._s(t.discount.products)+"\n                    ")],1)],1)],1)]),a("div",{staticClass:"content-2"})])])},s=[],i=(a("c975"),a("fb6a"),a("498a"),a("c973")),o=a.n(i),r=a("392b");let c=null,l=null;var u={name:"DiscountEdit",mixins:[r["a"]],meta(){return{title:"Edit Discount Rule"}},created(){this.getProducts(),this.getDiscount()},beforeCreate(){c=this.$RepositoryFactory.get("discounts"),l=this.$RepositoryFactory.get("products")},data(){return{loading:!1,hasSelect:!0,targets:["All","Regular","Reseller","Partner"],options:null,productsList:[],discount:{loading:!0,hasError:!1,data:{value:0,name:"",products:[],start:"",end:""}}}},methods:{_isValidDatetime(t){const e=/^\d{4}-(0?[1-9]|1[0-2])-(0?[1-9]|[12][0-9]|3[01]) (0?[0-9]|1[0-9]|2[0-3]):([0-9]|[0-5][0-9])$/g;return e.test(t)||"Invalid date & time format"},_isValidEndDt(t){const e=new Date(t),a=new Date(this.discount.data.start);return e.getTime()>a.getTime()||"End date needs to be greater"},filterFn(t,e,a){t&&""!=t.trim()?e((()=>{const e=t.toLowerCase();this.options=this.productsList.filter((t=>t.label.toLowerCase().indexOf(e)>-1))})):a()},getProducts(){var t=this;return o()((function*(){l.getProductSelection().then((e=>{t.productsList=e,t.options=t.productsList.slice()})).catch((e=>{t.productsList=[],t.options=[]}))}))()},getDiscount(){var t=this;return o()((function*(){try{const e=yield c.getDiscount(t.$route.params.id);t.discount.data=e}catch(e){t.showNotif(!1,"Could not retrieve discount details. "),t.discount.hasError=!0}finally{t.discount.loading=!1}}))()},onSubmit:function(){var t=o()((function*(t){this.loading=!0;try{yield c.editDiscount(this.$route.params.id,this.discount.data),this.showNotif(!0,"Successfully updated discount info."),this.returnToPageIndex("/discounts")}catch(e){this.showNotif(!1,"Could not edit discount info. ")}finally{this.loading=!1}}));return function(e){return t.apply(this,arguments)}}()}},d=u,p=(a("d64a"),a("3809"),a("2877")),f=a("9989"),m=a("0016"),h=a("0378"),g=a("66e5"),y=a("0d59"),v=a("1c1c"),D=a("27f9"),q=a("7cbe"),x=a("52ee"),b=a("ca78"),S=a("ddd8"),C=a("c1d0"),w=a("4074"),k=a("eb85"),_=a("9c40"),Y=a("cf57"),$=a("b047"),M=a("8572"),P=a("eebe"),Q=a.n(P),E=Object(p["a"])(d,n,s,!1,null,"0210cc06",null);e["default"]=E.exports;Q()(E,"components",{QPage:f["a"],QIcon:m["a"],QForm:h["a"],QItem:g["a"],QSpinner:y["a"],QList:v["a"],QInput:D["a"],QPopupProxy:q["a"],QDate:x["a"],QTime:b["a"],QSelect:S["a"],QSlider:C["a"],QItemSection:w["a"],QSeparator:k["a"],QBtn:_["a"],QSpinnerGears:Y["a"],QChip:$["a"],QField:M["a"]})},3809:function(t,e,a){"use strict";var n=a("56c9"),s=a.n(n);s.a},"392b":function(t,e,a){"use strict";a("4d90"),a("5319");var n,s,i={data(){return{prevRoute:null}},beforeRouteEnter(t,e,a){a((t=>{t.prevRoute=e}))},computed:{today(){const t=new Date,e={month:t.toLocaleDateString("en-US",{month:"long"}),year:t.getFullYear(),dayOfMonth:t.getDate(),dayOfWeek:t.getDay(),human:t.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),iso:t.toISOString(),yyyymmdd:t.getFullYear()+"-"+(t.getMonth()+1).toString().padStart(2,0)+"-"+t.getDate().toString().padStart(2,"0")};return e},startDayOfMonth(){const t=new Date;return new Date(t.getFullYear(),t.getMonth(),1)},lastDayOfMonth(){const t=new Date;return new Date(t.getFullYear(),t.getMonth()+1,0)}},methods:{replaceAll:function(t,e,a){return t.replace(new RegExp(e,"g"),a)},resolveAssetsUrl:function(t){return"https://localhost:3000/"+t},showNotif:function(t,e){this.$q.notify({color:t?"green-4":"negative",textColor:"white",icon:t?"check_circle_outline":"error_outline",timeout:"2500",position:"top",message:e})},returnToPageIndex:function(t){this.prevRoute&&"/"!==this.prevRoute.path?this.$router.go(-1):this.$router.push(t).catch((t=>{}))},findMaxDt:function(t,e){return new Date(Math.max(new Date(t),new Date(e)))},findMinDt:function(t,e){return new Date(Math.min(new Date(t),new Date(e)))},toQDateFormat:function(t){return t?t.getFullYear()+"/"+(t.getMonth()+1).toString().padStart(2,0)+"/"+t.getDate().toString().padStart(2,0):t},toHumanReadableDt:function(t){const e=new Date(t);return e?e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})+" "+e.getHours().toString().padStart(2,0)+":"+e.getMinutes().toString().padStart(2,0):t}}},o=i,r=a("2877"),c=Object(r["a"])(o,n,s,!1,null,null,null);e["a"]=c.exports},"56c9":function(t,e,a){},d64a:function(t,e,a){"use strict";var n=a("e283"),s=a.n(n);s.a},e283:function(t,e,a){}}]);