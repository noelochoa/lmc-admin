(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"1b67":function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-dialog",{attrs:{value:t.showDlg,seamless:"",persistent:"",square:"",position:"right"},on:{hide:t.emitClose}},[o("q-card",{staticClass:"product-dialog-content",attrs:{dark:""}},[o("q-card-section",[o("div",{staticClass:"text-h6"},[t._v("Select Product")])]),t.productReady?o("q-card-section",[t._t("product")],2):t._e(),o("q-inner-loading",{attrs:{dark:"",showing:t.dialogLoading}},[o("q-spinner-tail",{attrs:{size:"50px",color:"white"}})],1),t.productReady?o("q-card-actions",{attrs:{align:"right"}},[t._t("actions")],2):t._e()],1)],1)},i=[],r={name:"ProductPicker",props:{showDlg:{type:Boolean,required:!0,default:!1},dialogLoading:{type:Boolean,default:!1},productReady:{type:Boolean,default:!0}},methods:{emitClose(){this.$emit("update:showDlg",!1)}}},a=r,n=(o("f204"),o("2877")),c=o("24e8"),l=o("f09f"),d=o("a370"),u=o("74f7"),p=o("007d"),m=o("4b7e"),h=o("eebe"),f=o.n(h),g=Object(n["a"])(a,s,i,!1,null,"91e94df2",null);e["a"]=g.exports;f()(g,"components",{QDialog:c["a"],QCard:l["a"],QCardSection:d["a"],QInnerLoading:u["a"],QSpinnerTail:p["a"],QCardActions:m["a"]})},"2ec6":function(t,e,o){"use strict";var s=o("495c"),i=o.n(s);i.a},"392b":function(t,e,o){"use strict";o("4d90"),o("5319");var s,i,r={data(){return{prevRoute:null}},beforeRouteEnter(t,e,o){o((t=>{t.prevRoute=e}))},computed:{today(){const t=new Date,e={month:t.toLocaleDateString("en-US",{month:"long"}),year:t.getFullYear(),dayOfMonth:t.getDate(),dayOfWeek:t.getDay(),human:t.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),iso:t.toISOString(),yyyymmdd:t.getFullYear()+"-"+(t.getMonth()+1).toString().padStart(2,0)+"-"+t.getDate().toString().padStart(2,"0")};return e},startDayOfMonth(){const t=new Date;return new Date(t.getFullYear(),t.getMonth(),1)},lastDayOfMonth(){const t=new Date;return new Date(t.getFullYear(),t.getMonth()+1,0)}},methods:{replaceAll:function(t,e,o){return t.replace(new RegExp(e,"g"),o)},resolveAssetsUrl:function(t){return"https://localhost:3000/"+t},showNotif:function(t,e){this.$q.notify({color:t?"green-4":"negative",textColor:"white",icon:t?"check_circle_outline":"error_outline",timeout:"2500",position:"top",message:e})},returnToPageIndex:function(t){this.prevRoute&&"/"!==this.prevRoute.path?this.$router.go(-1):this.$router.push(t).catch((t=>{}))},findMaxDt:function(t,e){return new Date(Math.max(new Date(t),new Date(e)))},findMinDt:function(t,e){return new Date(Math.min(new Date(t),new Date(e)))},toQDateFormat:function(t){return t?t.getFullYear()+"/"+(t.getMonth()+1).toString().padStart(2,0)+"/"+t.getDate().toString().padStart(2,0):t},toHumanReadableDt:function(t){const e=new Date(t);return e?e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})+" "+e.getHours().toString().padStart(2,0)+":"+e.getMinutes().toString().padStart(2,0):t}}},a=r,n=o("2877"),c=Object(n["a"])(a,s,i,!1,null,null,null);e["a"]=c.exports},"495c":function(t,e,o){},"5d23":function(t,e,o){},d15b:function(t,e,o){},df54:function(t,e,o){"use strict";var s=o("5d23"),i=o.n(s);i.a},e750:function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-page",{staticClass:"q-px-md q-pt-lg"},[o("div",{staticClass:"page-heading text-white q-pa-md"},[o("div",{staticClass:"heading-caption"},[o("h6",[t._v("Add Order")]),o("br"),o("p",[t._v("\n                Fill out the form to manually place an order.\n            ")])])]),o("div",{staticClass:"page-contents text-white q-pa-md"},[o("div",{staticClass:"content-1"},[o("div",{staticClass:"text-subtitle2 flex flex-center"},[o("q-icon",{staticClass:"caption-icon q-mx-md",attrs:{name:"account_circle"}}),t._v("Order Info\n            ")],1),o("div",[o("q-form",{on:{submit:function(e){return e.preventDefault(),e.stopPropagation(),t.onSubmit(e)}}},[o("q-list",{staticClass:"detail-list",attrs:{separator:""}},[o("q-item",{staticClass:"detail-field"},[o("span",{staticClass:"field-label"},[t._v("Target Date")]),o("q-input",{staticClass:"field-value",attrs:{dense:"",outlined:"","hide-bottom-space":"",dark:"",rules:[function(t){return null!==t&&""!==t.trim()},t._isValidDatetime]},scopedSlots:t._u([{key:"prepend",fn:function(){return[o("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[o("q-popup-proxy",{ref:"qDateProxyS",attrs:{"transition-show":"scale","transition-hide":"scale"}},[o("q-date",{attrs:{dark:"","no-unset":"",mask:"YYYY-MM-DD HH:mm"},on:{input:function(){return t.$refs.qDateProxyS.hide()}},model:{value:t.order.target,callback:function(e){t.$set(t.order,"target",e)},expression:"order.target"}})],1)],1)]},proxy:!0},{key:"append",fn:function(){return[o("q-icon",{staticClass:"cursor-pointer",attrs:{name:"access_time"}},[o("q-popup-proxy",{ref:"qTimeProxyS",attrs:{"transition-show":"scale","transition-hide":"scale"}},[o("q-time",{attrs:{dark:"",mask:"YYYY-MM-DD HH:mm",format24h:""},on:{input:function(){return t.$refs.qTimeProxyS.hide()}},model:{value:t.order.target,callback:function(e){t.$set(t.order,"target",e)},expression:"order.target"}})],1)],1)]},proxy:!0}]),model:{value:t.order.target,callback:function(e){t.$set(t.order,"target",e)},expression:"order.target"}})],1),o("q-item",{staticClass:"detail-field"},[o("span",{staticClass:"field-label"},[t._v("Delivery Type")]),o("q-select",{staticClass:"field-value",attrs:{options:t.deliveryTypes,dark:"",dense:"",outlined:"","hide-bottom-space":"","options-dense":"","emit-value":"","map-options":"","lazy-rules":"",rules:[t._isValidType]},model:{value:t.order.type,callback:function(e){t.$set(t.order,"type",e)},expression:"order.type"}})],1),o("q-item",{staticClass:"detail-field"},[o("span",{staticClass:"field-label"},[t._v("Customer")]),o("q-select",{staticClass:"field-value customer-select",attrs:{options:t.options,"hide-dropdown-icon":"","hide-bottom-space":"",dark:"",dense:"","options-dense":"",outlined:"","use-input":"","emit-value":"","map-options":"","lazy-rules":"",rules:[function(t){return null!==t}]},on:{filter:t.filterFn,input:t.onSelCustomer},scopedSlots:t._u([{key:"append",fn:function(){return[o("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(e){return e.stopPropagation(),t.clearSelCustomer(e)}}})]},proxy:!0},{key:"no-option",fn:function(){return[o("q-item",[o("q-item-section",{staticClass:"text-italic text-grey"},[t._v("\n                                            No customer account found.\n                                        ")])],1)]},proxy:!0}]),model:{value:t.order.customer,callback:function(e){t.$set(t.order,"customer",e)},expression:"order.customer"}})],1),o("transition",{attrs:{name:"fade"}},["delivery"==t.order.type?o("q-item",{staticClass:"detail-field"},[o("span",{staticClass:"field-label"},[t._v("Address")]),o("q-input",{staticClass:"field-value",attrs:{dense:"",outlined:"",dark:"","hide-bottom-space":"","lazy-rules":"",rules:[function(t){return null!==t&&""!==t.trim()}]},model:{value:t.order.address,callback:function(e){t.$set(t.order,"address",e)},expression:"order.address"}})],1):t._e()],1),o("q-item",{staticClass:"detail-field product-field"},[o("span",{staticClass:"field-label"},[t._v("\n                                Products\n                            ")]),o("div",{staticClass:"product-details q-py-sm"},[t._l(t.order.products,(function(e,s){return o("q-item",{key:"product-"+s,staticClass:"product-item"},[o("q-item-section",{attrs:{side:""}},[o("q-avatar",{attrs:{rounded:"",size:"64px"}},[o("img",{attrs:{src:e.image?t.resolveAssetsUrl(e.image):"https://dummyimage.com/64x64/363636/ffffff.png&text=No+Img"}}),o("q-badge",{staticClass:"q-pt-xs",attrs:{floating:"",color:"teal"}},[t._v("\n                                                "+t._s(e.quantity)+"\n                                            ")])],1)],1),o("q-item-section",[o("q-item-label",{staticClass:"product-name"},[t._v("\n                                            "+t._s(e.name)+"\n                                        ")]),o("q-item-label",{staticClass:"text-grey-4 product-name",attrs:{caption:""}},t._l(e.options,(function(e,s){return o("span",{key:"optKey-"+s},[t._v("\n                                                "+t._s(e._option+": "+e._selected)+"\n                                                "),null!=e.otherValue?o("span",[t._v("("+t._s(e.otherValue)+") ")]):t._e(),o("br")])})),0)],1),o("q-item-section",{staticClass:"text-white",attrs:{side:""}},[e.discount>0?o("span",[o("span",{staticClass:"text-strike"},[t._v("\n                                                "+t._s(e.price)+"\n                                            ")]),t._v("\n                                            (-"+t._s(e.discount)+"%)"),o("br"),t._v("\n                                            "+t._s(e.finalPrice)+" PHP\n                                        ")]):o("span",[t._v(t._s(e.price)+" PHP\n                                        ")])]),o("q-item-section",{staticClass:"text-white",attrs:{side:"",caption:""}},[o("q-btn",{staticClass:"ml-auto",attrs:{flat:"",dense:"",rounded:"",icon:"clear",disabled:t.showProductAdd},on:{click:function(e){return t.removeProduct(s)}}},[o("q-tooltip",[t._v("\n                                                Remove Product\n                                            ")])],1)],1)],1)})),o("q-btn",{attrs:{dense:"",flat:"","no-caps":"",icon:"add",label:"Add Product",disabled:t.showProductAdd},on:{click:function(e){return t.openProductPicker()}}})],2)]),o("q-item",{staticClass:"detail-field"},[o("span",{staticClass:"field-label"},[t._v("\n                                Memo\n                            ")]),o("q-input",{staticClass:"field-value",attrs:{type:"textarea",rows:3,textarea:"",dense:"",outlined:"",dark:"","hide-bottom-space":""},model:{value:t.order.memo,callback:function(e){t.$set(t.order,"memo",e)},expression:"order.memo"}})],1),o("q-item",{staticClass:"detail-field"},[o("span",{staticClass:"field-label"},[t._v("Total Price")]),t._v("\n                            "+t._s(t.orderTotalPrice)+" PHP\n                        ")])],1),o("q-separator"),o("div",{staticClass:"q-pa-md"},[o("q-btn",{attrs:{label:"Place Order",type:"submit",color:"primary",loading:t.loading,disable:t.loading||this.order.products.length<1},scopedSlots:t._u([{key:"loading",fn:function(){return[o("q-spinner-gears")]},proxy:!0}])})],1)],1)],1)]),o("div",{staticClass:"content-2"}),o("ProductPicker",{attrs:{showDlg:t.showProductAdd},on:{"update:showDlg":function(e){t.showProductAdd=e},"update:show-dlg":function(e){t.showProductAdd=e},hide:function(e){return t.onCloseDialog(t.val)}},scopedSlots:t._u([{key:"product",fn:function(){return[o("q-form",{ref:"selProductForm"},[o("q-item",{staticClass:"productdlg-item"},[o("q-select",{staticClass:"search-field",attrs:{"popup-content-class":"options-light",options:t.productOptions,label:"Search Product","hide-dropdown-icon":"","hide-bottom-space":"",dark:"","options-dark":"",outlined:"","use-input":"","emit-value":"","map-options":"",debounce:"250",loading:t.pfilterLoading},on:{filter:t.pfilterFn,input:t.onSelectProduct},scopedSlots:t._u([{key:"prepend",fn:function(){return[o("q-icon",{attrs:{name:"search",color:"white"}})]},proxy:!0},{key:"append",fn:function(){return[t.pfilterLoading?t._e():o("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(e){e.stopPropagation(),t.searchProduct=null,t.selectProduct=null}}})]},proxy:!0},{key:"no-option",fn:function(){return[o("q-item",{staticClass:"options-light"},[o("q-item-section",{staticClass:"text-italic text-grey"},[t._v("\n                                        No products found.\n                                    ")])],1)]},proxy:!0}]),model:{value:t.searchProduct,callback:function(e){t.searchProduct=e},expression:"searchProduct"}})],1),t.selectProduct?o("q-list",{staticClass:"productdlg-list"},[o("q-item",{staticClass:"productdlg-item"},[o("div",{staticClass:"attr-label text-grey-6"},[t._v("\n                                Name\n                            ")]),o("div",{staticClass:"attr-value"},[t._v("\n                                "+t._s(t.selectProduct.name)+"\n                            ")])]),o("q-item",{staticClass:"productdlg-item"},[o("div",{staticClass:"attr-label text-grey-6"},[t._v("\n                                Qty. (MIN:\n                                "+t._s(t.selectProduct.minOrderQuantity)+")\n                            ")]),o("q-input",{staticClass:"attr-value",attrs:{dense:"",outlined:"","hide-bottom-space":"",dark:"",type:"number",min:t.selectProduct.minOrderQuantity},on:{input:t.onChgQty},model:{value:t.customizedProduct.quantity,callback:function(e){t.$set(t.customizedProduct,"quantity",e)},expression:"customizedProduct.quantity"}})],1),o("q-item",{staticClass:"productdlg-item"},[o("div",{staticClass:"attr-label text-grey-6"},[t._v("\n                                Options\n                            ")]),t._l(t.selectProduct.options,(function(e,s){return o("div",{key:"optKey-"+s,staticClass:"attr-value q-my-sm"},[o("span",{staticClass:"capitalize option-label"},[t._v("\n                                    "+t._s(e.attribute)+"\n                                ")]),o("q-select",{attrs:{"popup-content-class":"options-light",dense:"",dark:"",outlined:"",options:t.toSelOptions(e.attribute,e.choices),"lazy-rules":"",rules:[function(t){return!!t}]},on:{input:function(e){return t.onSelOption(s)}},model:{value:t.customizedProduct.options[s],callback:function(e){t.$set(t.customizedProduct.options,s,e)},expression:"customizedProduct.options[key]"}}),t.isOtherSelected(t.customizedProduct.options[s])?o("q-input",{attrs:{dense:"",dark:"",outlined:"",placeholder:"Please specify","lazy-rules":"",rules:[function(t){return!!t}]},model:{value:t.customizedProduct.otherVal[s],callback:function(e){t.$set(t.customizedProduct.otherVal,s,e)},expression:"\n                                        customizedProduct.otherVal[key]\n                                    "}}):t._e()],1)}))],2),o("q-item",{staticClass:"productdlg-item"},[o("div",{staticClass:"attr-label text-grey-6"},[t._v("\n                                Price (PHP)\n                            ")]),o("div",{staticClass:"attr-value"},[t._v("\n                                "+t._s(t.customizedProduct.price)+"\n                            ")])])],1):t._e()],1)]},proxy:!0},{key:"actions",fn:function(){return[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"},on:{click:t.onCloseDialog}}),o("q-btn",{attrs:{flat:"",label:"Add",color:"primary"},on:{click:t.onSetProduct}})]},proxy:!0}])})],1)])},i=[],r=(o("c975"),o("fb6a"),o("498a"),o("c973")),a=o.n(r),n=o("1b67"),c=o("392b");let l=null,d=null,u=null;var p={name:"OrderAdd",components:{ProductPicker:n["a"]},mixins:[c["a"]],meta(){return{title:"Add Order"}},beforeCreate(){l=this.$RepositoryFactory.get("accounts"),d=this.$RepositoryFactory.get("products"),u=this.$RepositoryFactory.get("orders")},created(){this.getAccounts()},computed:{orderTotalPrice(){return this.order.products.length>0?this.order.products.reduce(((t,e)=>t+Number.parseInt(e.finalPrice?e.finalPrice:e.price)),0):0}},data(){return{showProductAdd:!1,loading:!1,pfilterLoading:!1,order:{products:[],customer:null,target:null,address:"",type:"delivery",memo:""},deliveryTypes:[{label:"For Delivery",value:"delivery"},{label:"For Pickup",value:"pickup"}],customerList:[],productList:[],options:null,productOptions:null,searchProduct:null,selectProduct:null,customizedProduct:{id:-1,name:"",image:"",quantity:0,price:0,discounts:[],options:[],otherVal:[]}}},methods:{_isValidType(t){if(!(this.order.type&&this.deliveryTypes&&this.deliveryTypes.length>0))return"Invalid type selected";const e=this.deliveryTypes.find((t=>t.value===this.order.type));return!!e||"Invalid type selected"},_isValidDatetime(t){const e=/^\d{4}-(0?[1-9]|1[0-2])-(0?[1-9]|[12][0-9]|3[01]) (0?[0-9]|1[0-9]|2[0-3]):([0-9]|[0-5][0-9])$/g;return e.test(t)||"Invalid date & time format"},filterFn(t,e,o){t&&""!=t.trim()?e((()=>{const e=t.toLowerCase();this.options=this.customerList.filter((t=>t.label.toLowerCase().indexOf(e)>-1))})):o()},pfilterFn(t,e,o){var s=this;return a()((function*(){if(t&&""!=t.trim())try{s.pfilterLoading=!0;const o=yield d.searchProducts(t);s.productList=o.products.slice(),e((()=>{s.productOptions=s.productList.map((t=>({label:t.name,value:t.id})))}))}catch(i){s.showNotif(!1,"Error searching product/s."+i)}finally{s.pfilterLoading=!1}else o()}))()},removeProduct(t){this.$delete(this.order.products,t)},openProductPicker(t){this.selectProduct=null,this.searchProduct=null,this.showProductAdd=!0},clearSelection(){this.customizedProduct.id=-1,this.customizedProduct.name="",this.customizedProduct.image="",this.customizedProduct.options=[],this.customizedProduct.discounts=[],this.customizedProduct.otherVal=[],this.customizedProduct.quantity=0,this.customizedProduct.price=0},clearSelCustomer(){this.order.customer=null,this.order.products.forEach((t=>{t.discount=0,t.finalPrice=t.price}))},onCloseDialog(){},onSelectProduct(t){this.selectProduct=this.productList.find((e=>e.id==t)),this.clearSelection(),this.customizedProduct.id=this.selectProduct.id,this.customizedProduct.name=this.selectProduct.name,this.customizedProduct.image=this.selectProduct.images&&this.selectProduct.images.length>0?this.selectProduct.images[0].image:null,this.customizedProduct.quantity=this.selectProduct.minOrderQuantity,this.customizedProduct.discounts=this.selectProduct.discount,this.calcCustomizationPrice()},finalizePrice(){const t=this.customerList.find((t=>t.value==this.order.customer));t&&this.order.products.forEach((e=>{const o=e.discounts.filter((e=>e.target==t.type||"all"==e.target));if(o&&o.length>0){const t=Math.max.apply(Math,o.map((function(t){return t.percent}))),s=(e.price-e.price*t/100).toFixed(0);e.discount=t,e.finalPrice=s}}))},onSelCustomer(t){this.finalizePrice()},onSetProduct(t){this.$refs.selProductForm.validate().then((t=>{t&&this.selectProduct&&(this.order.products.push({product:this.customizedProduct.id,name:this.customizedProduct.name,image:this.customizedProduct.image,price:this.customizedProduct.price,quantity:this.customizedProduct.quantity,discount:0,finalPrice:this.customizedProduct.price,discounts:this.customizedProduct.discounts,options:this.customizedProduct.options.map(((t,e)=>({_option:t.key,_selected:t.value.value,otherValue:"Other"==t.value.value?this.customizedProduct.otherVal[e]:null})))}),this.finalizePrice(),this.showProductAdd=!1,this.clearSelection())}))},onChgQty(t){this.calcCustomizationPrice()},onSelOption(t){this.calcCustomizationPrice()},calcCustomizationPrice(){const t=(t,e)=>t+e.value.price;this.customizedProduct.price=this.customizedProduct.quantity*this.customizedProduct.options.reduce(t,this.selectProduct.basePrice)},toSelOptions(t,e){return e?e.map((e=>({label:e.value+(e.price>=0?`(+${e.price}  PHP)`:`(${e.price} PHP)`),value:e,key:t}))):e},isOtherSelected(t){return!!t&&"Other"==t.value.value},getAccounts(){var t=this;return a()((function*(){l.getAccountSelection().then((e=>{t.customerList=e})).catch((e=>{t.customerList=[]}))}))()},onSubmit:function(){var t=a()((function*(t){this.loading=!0;try{if(this.order.products.length<1)throw"No products selected";yield u.placeOrder(this.order),this.showNotif(!0,"Placed new Order."),this.returnToPageIndex("/orders")}catch(e){this.showNotif(!1,"Could not place the order. ")}finally{this.loading=!1}}));return function(e){return t.apply(this,arguments)}}()}},m=p,h=(o("2ec6"),o("df54"),o("2877")),f=o("9989"),g=o("0016"),P=o("0378"),y=o("1c1c"),v=o("66e5"),q=o("27f9"),C=o("7cbe"),b=o("52ee"),_=o("ca78"),x=o("ddd8"),k=o("4074"),S=o("cb32"),w=o("58a81"),z=o("0170"),D=o("9c40"),Q=o("05c0"),O=o("eb85"),$=o("cf57"),L=o("8572"),A=o("7f67"),F=o("eebe"),M=o.n(F),T=Object(h["a"])(m,s,i,!1,null,"251d6cf6",null);e["default"]=T.exports;M()(T,"components",{QPage:f["a"],QIcon:g["a"],QForm:P["a"],QList:y["a"],QItem:v["a"],QInput:q["a"],QPopupProxy:C["a"],QDate:b["a"],QTime:_["a"],QSelect:x["a"],QItemSection:k["a"],QAvatar:S["a"],QBadge:w["a"],QItemLabel:z["a"],QBtn:D["a"],QTooltip:Q["a"],QSeparator:O["a"],QSpinnerGears:$["a"],QField:L["a"]}),M()(T,"directives",{ClosePopup:A["a"]})},f204:function(t,e,o){"use strict";var s=o("d15b"),i=o.n(s);i.a}}]);